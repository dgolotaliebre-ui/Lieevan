<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Furgonetas - Liebre Express SL</title>
    
    <!-- Librer√≠as externas -->
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <script src="[https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js](https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js)"></script>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="[https://fonts.googleapis.com](https://fonts.googleapis.com)">
    <link rel="preconnect" href="[https://fonts.gstatic.com](https://fonts.gstatic.com)" crossorigin>
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap)" rel="stylesheet">
    
    <!-- Tu archivo de estilos -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="h-full p-4 md:p-8 selection:bg-blue-500 selection:text-white">

    <!-- PANTALLA DE LOGIN -->
    <div id="login-modal" class="max-w-md mx-auto mt-10 md:mt-20 p-8 bg-slate-800/80 backdrop-blur-lg rounded-2xl shadow-2xl border border-slate-700">
        <h1 class="text-3xl font-bold text-white text-center mb-4">
            Liebre<span class="text-blue-400">Express</span> SL
        </h1>
        <h2 class="text-xl font-semibold text-gray-300 text-center mb-8">
            Control de Flota
        </h2>
        <form id="login-form" class="space-y-6">
            <div>
                <label for="password-input" class="block text-sm font-medium text-gray-300 mb-2">Contrase√±a de Acceso:</label>
                <input type="password" id="password-input" name="password" required autocomplete="current-password"
                       class="w-full text-lg px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
            </div>
            <div id="login-status" class="hidden p-3 rounded-lg text-center text-sm font-medium"></div>
            <button type="submit" id="login-button" class="w-full text-lg font-bold py-3 px-6 rounded-lg bg-blue-600 hover:bg-blue-500 text-white shadow-lg transition-all transform active:scale-95">
                Entrar al Sistema
            </button>
        </form>
    </div>

    <!-- APLICACI√ìN PRINCIPAL (Oculta al inicio) -->
    <div id="app-container" class="max-w-6xl mx-auto hidden">
        
        <header class="text-center my-6 md:my-8 flex flex-col items-center">
            <h1 class="text-3xl md:text-5xl font-bold text-white tracking-tight drop-shadow-lg">
                Liebre<span class="text-blue-500">Express</span> SL
            </h1>
            <div id="global-visit-counter" class="text-xs text-slate-400 mt-2 px-3 py-1 bg-slate-800 rounded-full border border-slate-700">
                Cargando visitas...
            </div>
        </header>

        <!-- BARRA DE NAVEGACI√ìN -->
        <nav class="mb-8 sticky top-2 z-30 bg-slate-900/90 backdrop-blur shadow-lg rounded-xl border border-slate-700 p-1 overflow-x-auto">
            <div class="flex space-x-1 min-w-max px-2">
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-semibold transition-colors text-white bg-blue-600" data-page="page-operativa-vor" id="nav-link-page-operativa-vor">Operativas</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-guantera" id="nav-link-page-guantera">Guantera</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-qr-vans" id="nav-link-page-qr-vans">QR</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-seleccion-vans" id="nav-link-page-seleccion-vans">Taller</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-neumaticos" id="nav-link-page-neumaticos">Neum√°ticos</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-registro-alquiler" id="nav-link-page-registro-alquiler">Alquiler</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-accidentes" id="nav-link-page-accidentes">Accidentes</a>
                <a href="#" class="nav-link py-2 px-4 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-slate-800 transition-colors" data-page="page-gestionar-flota" id="nav-link-page-gestionar-flota">Admin Flota</a>
            </div>
        </nav>

        <main id="page-container" class="pb-20">

            <!-- 1. SECCI√ìN TALLER (SELECCI√ìN) -->
            <div id="page-seleccion-vans" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <div id="vans-choice-menu" class="vans-subpage">
                    <h2 class="text-2xl text-white font-bold mb-6 text-center">Taller y Mantenimiento</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="btn-show-van-upload" class="p-6 bg-blue-600/20 border border-blue-500/50 hover:bg-blue-600/40 rounded-xl text-left group transition-all">
                            <span class="block text-2xl mb-2">üõ†Ô∏è</span>
                            <h3 class="text-xl font-bold text-blue-100 group-hover:text-white">Crear Tarea / Reparaci√≥n</h3>
                            <p class="text-sm text-blue-300">Reportar aver√≠a o pedir recambios</p>
                        </button>
                        <button id="btn-show-van-gallery" class="p-6 bg-slate-700/30 border border-slate-600 hover:bg-slate-700/50 rounded-xl text-left group transition-all">
                            <span class="block text-2xl mb-2">üìã</span>
                            <h3 class="text-xl font-bold text-gray-200 group-hover:text-white">Ver Historial Tareas</h3>
                            <p class="text-sm text-gray-400">Consultar tareas pendientes y completadas</p>
                        </button>
                        <button id="btn-show-stock" class="md:col-span-2 p-6 bg-amber-600/20 border border-amber-500/50 hover:bg-amber-600/40 rounded-xl text-left group transition-all">
                            <span class="block text-2xl mb-2">üì¶</span>
                            <h3 class="text-xl font-bold text-amber-100 group-hover:text-white">Stock de Recambios</h3>
                            <p class="text-sm text-amber-300">Gestionar inventario del taller</p>
                        </button>
                    </div>
                </div>

                <!-- Subp√°ginas de Taller (Ocultas) -->
                <div id="vans-subpage-upload" class="vans-subpage hidden">
                    <button class="btn-back-to-vans-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                    <h3 class="text-xl font-bold text-white mb-4">Nueva Tarea</h3>
                    <input type="search" id="search-van" placeholder="Buscar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-4">
                    <div id="van-list-container" class="space-y-4"></div>
                    <div id="no-results-message" class="hidden text-center text-gray-500 mt-4">No se encontraron furgonetas.</div>
                </div>

                <div id="vans-subpage-gallery" class="vans-subpage hidden">
                    <div id="van-history-list-page">
                        <button class="btn-back-to-vans-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                        <h3 class="text-xl font-bold text-white mb-4">Historial de Tareas</h3>
                        <input type="search" id="search-van-history" placeholder="Filtrar por matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-4">
                        <p id="history-loading-message" class="text-center text-gray-400">Cargando...</p>
                        <div id="van-history-list-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <div id="van-history-no-results" class="hidden text-center text-gray-500">Sin resultados.</div>
                    </div>
                    <div id="van-history-detail-page" class="hidden">
                        <button id="btn-back-to-history-list" class="mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver al listado</button>
                        <h2 id="van-history-detail-title" class="text-2xl font-bold text-white mb-6"></h2>
                        <div id="van-history-detail-content" class="space-y-6"></div>
                    </div>
                </div>

                <div id="vans-subpage-stock" class="vans-subpage hidden">
                    <button class="btn-back-to-vans-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                    <h3 class="text-xl font-bold text-amber-400 mb-4">Inventario</h3>
                    <form id="stock-form" class="bg-slate-900/50 p-4 rounded-lg border border-slate-600 mb-6 flex flex-col md:flex-row gap-3">
                        <input type="text" id="stock-name" placeholder="Nombre del recambio" class="flex-grow p-2 bg-slate-800 border border-slate-600 rounded text-white" required>
                        <input type="number" id="stock-quantity" placeholder="Cant." class="w-24 p-2 bg-slate-800 border border-slate-600 rounded text-white" required>
                        <button type="submit" id="stock-save-btn" class="bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-500">Guardar</button>
                    </form>
                    <input type="search" id="search-stock" placeholder="Buscar en inventario..." class="w-full p-2 bg-slate-800 border border-slate-600 rounded text-white mb-4">
                    <div id="stock-list-loading" class="text-center text-gray-500">Cargando...</div>
                    <div id="stock-list-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
                </div>
            </div>

            <!-- 2. SECCI√ìN QR -->
            <div id="page-qr-vans" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <h2 class="text-2xl font-bold text-white mb-6">C√≥digos QR (VIN)</h2>
                <input type="search" id="search-qr-van" placeholder="Buscar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-6">
                <div id="qr-van-list-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div id="qr-no-results-message" class="hidden text-center text-gray-500">No encontrado.</div>
            </div>

            <!-- 3. SECCI√ìN NEUM√ÅTICOS -->
            <div id="page-neumaticos" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <div id="neumaticos-choice-menu" class="neumaticos-subpage">
                    <h2 class="text-2xl font-bold text-white mb-6 text-center">Control de Neum√°ticos</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="btn-show-upload" class="p-6 bg-blue-600/20 border border-blue-500/50 hover:bg-blue-600/40 rounded-xl text-center transition-all">
                            <span class="text-3xl block mb-2">üì∏</span>
                            <span class="font-bold text-blue-100">Subir Estado</span>
                        </button>
                        <button id="btn-show-gallery" class="p-6 bg-slate-700/30 border border-slate-600 hover:bg-slate-700/50 rounded-xl text-center transition-all">
                            <span class="text-3xl block mb-2">üìÇ</span>
                            <span class="font-bold text-gray-200">Ver Historial</span>
                        </button>
                    </div>
                </div>

                <div id="neumaticos-subpage-upload" class="neumaticos-subpage hidden">
                    <button class="btn-back-to-neumaticos-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                    <form id="tire-upload-form">
                        <input type="search" id="search-matricula-neumaticos" placeholder="1. Buscar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-2">
                        <div id="matricula-list-neumaticos" class="max-h-40 overflow-y-auto bg-slate-900 rounded-lg mb-4 border border-slate-700 p-2"></div>
                        <input type="hidden" id="matricula-hidden-neumaticos">
                        <div id="matricula-no-results-neumaticos" class="hidden text-gray-500 text-center mb-4">No encontrada.</div>

                        <h4 class="text-lg text-white mb-4 mt-6">2. Fotos de Ruedas</h4>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <!-- Fotos Inputs -->
                            <div class="bg-slate-900 p-3 rounded-lg text-center">
                                <label class="block text-sm text-gray-400 mb-2">Del. Derecha</label>
                                <img id="preview-fd" src="[https://placehold.co/100x100/333/999?text=Foto](https://placehold.co/100x100/333/999?text=Foto)" class="w-full h-24 object-cover rounded mb-2">
                                <input type="file" id="file-fd" class="tire-photo-input hidden" accept="image/*" capture="environment">
                                <label for="file-fd" class="block bg-blue-600 text-xs py-2 rounded cursor-pointer hover:bg-blue-500">Tomar Foto</label>
                            </div>
                            <div class="bg-slate-900 p-3 rounded-lg text-center">
                                <label class="block text-sm text-gray-400 mb-2">Del. Izquierda</label>
                                <img id="preview-fi" src="[https://placehold.co/100x100/333/999?text=Foto](https://placehold.co/100x100/333/999?text=Foto)" class="w-full h-24 object-cover rounded mb-2">
                                <input type="file" id="file-fi" class="tire-photo-input hidden" accept="image/*" capture="environment">
                                <label for="file-fi" class="block bg-blue-600 text-xs py-2 rounded cursor-pointer hover:bg-blue-500">Tomar Foto</label>
                            </div>
                            <div class="bg-slate-900 p-3 rounded-lg text-center">
                                <label class="block text-sm text-gray-400 mb-2">Tras. Derecha</label>
                                <img id="preview-tr" src="[https://placehold.co/100x100/333/999?text=Foto](https://placehold.co/100x100/333/999?text=Foto)" class="w-full h-24 object-cover rounded mb-2">
                                <input type="file" id="file-tr" class="tire-photo-input hidden" accept="image/*" capture="environment">
                                <label for="file-tr" class="block bg-blue-600 text-xs py-2 rounded cursor-pointer hover:bg-blue-500">Tomar Foto</label>
                            </div>
                            <div class="bg-slate-900 p-3 rounded-lg text-center">
                                <label class="block text-sm text-gray-400 mb-2">Tras. Izquierda</label>
                                <img id="preview-ti" src="[https://placehold.co/100x100/333/999?text=Foto](https://placehold.co/100x100/333/999?text=Foto)" class="w-full h-24 object-cover rounded mb-2">
                                <input type="file" id="file-ti" class="tire-photo-input hidden" accept="image/*" capture="environment">
                                <label for="file-ti" class="block bg-blue-600 text-xs py-2 rounded cursor-pointer hover:bg-blue-500">Tomar Foto</label>
                            </div>
                        </div>
                        <div id="status-message-neumaticos" class="hidden p-3 mb-4 rounded text-center"></div>
                        <button type="submit" id="submit-button-neumaticos" class="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg">Guardar Fotos</button>
                    </form>
                </div>

                <div id="neumaticos-subpage-gallery" class="neumaticos-subpage hidden">
                    <div id="tire-history-list-page">
                         <button class="btn-back-to-neumaticos-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                         <input type="search" id="search-tire-history" placeholder="Buscar historial..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-4">
                         <p id="tire-history-loading-message" class="text-center text-gray-500">Cargando...</p>
                         <div id="tire-history-list-container" class="space-y-3"></div>
                         <div id="tire-history-no-results" class="hidden text-center text-gray-500">Vacio.</div>
                    </div>
                    <div id="tire-history-detail-page" class="hidden">
                         <button id="btn-back-to-tire-list" class="mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                         <h2 id="tire-history-detail-title" class="text-xl font-bold text-white mb-4"></h2>
                         <div id="tire-history-detail-content" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- 4. SECCI√ìN ALQUILER -->
            <div id="page-registro-alquiler" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <div id="alquiler-choice-menu" class="alquiler-subpage">
                    <h2 class="text-2xl font-bold text-white mb-6 text-center">Registro de Alquiler</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="btn-show-rental-upload-entrega" class="p-6 bg-blue-600/20 border border-blue-500/50 hover:bg-blue-600/40 rounded-xl text-center">
                            <span class="text-3xl block mb-2">üì•</span>
                            <span class="font-bold text-blue-100">Registrar Entrega (Entrada)</span>
                        </button>
                        <button id="btn-show-rental-upload-devolucion" class="p-6 bg-green-600/20 border border-green-500/50 hover:bg-green-600/40 rounded-xl text-center">
                            <span class="text-3xl block mb-2">üì§</span>
                            <span class="font-bold text-green-100">Registrar Devoluci√≥n (Salida)</span>
                        </button>
                        <button id="btn-show-rental-gallery" class="md:col-span-2 p-4 bg-slate-700/30 border border-slate-600 hover:bg-slate-700/50 rounded-xl text-center">
                            Ver Historial Completo
                        </button>
                    </div>
                </div>

                <div id="alquiler-subpage-upload" class="alquiler-subpage hidden">
                    <button class="btn-back-to-alquiler-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                    <h2 id="rental-upload-title" class="text-xl font-bold text-white mb-6 text-center"></h2>
                    <form id="rental-upload-form" class="space-y-6">
                        <input type="hidden" id="rental-tipo-registro" name="tipo_registro">
                        
                        <input type="text" id="rental-matricula" placeholder="MATR√çCULA (Ej: 1234ABC)" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white uppercase font-bold text-center tracking-widest" maxlength="7" required>

                        <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                            <h4 class="text-sm text-gray-400 mb-3 uppercase font-bold">Equipamiento</h4>
                            <div id="rental-equipamiento-container" class="grid grid-cols-2 gap-3">
                                <label class="flex items-center space-x-2"><input type="checkbox" data-key="extintor" class="w-5 h-5 rounded"> <span>Extintor</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-key="martillo" class="w-5 h-5 rounded"> <span>Martillo</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-key="carro" class="w-5 h-5 rounded"> <span>Carro</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-key="botiquin" class="w-5 h-5 rounded"> <span>Botiqu√≠n</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-key="permiso" class="w-5 h-5 rounded"> <span>Permiso</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-key="ficha" class="w-5 h-5 rounded"> <span>Ficha T√©c.</span></label>
                            </div>
                        </div>

                        <!-- Fotos Simplificadas -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="bg-slate-900 p-2 rounded text-center">
                                <span class="text-xs text-gray-400 block mb-1">Frontal</span>
                                <img id="preview-rental-frontal" src="[https://placehold.co/100x80/333/999](https://placehold.co/100x80/333/999)" class="w-full h-16 object-cover rounded mb-1">
                                <input type="file" id="file-rental-frontal" data-key="frontal" class="hidden rental-photo-input-single" accept="image/*" capture="environment">
                                <label for="file-rental-frontal" class="text-xs bg-blue-600 px-2 py-1 rounded cursor-pointer block">Foto</label>
                            </div>
                            <!-- Repetir para otros √°ngulos si se desea, simplificado aqu√≠ -->
                            <div class="bg-slate-900 p-2 rounded text-center">
                                <span class="text-xs text-gray-400 block mb-1">Trasera</span>
                                <img id="preview-rental-trasera" src="[https://placehold.co/100x80/333/999](https://placehold.co/100x80/333/999)" class="w-full h-16 object-cover rounded mb-1">
                                <input type="file" id="file-rental-trasera" data-key="trasera" class="hidden rental-photo-input-single" accept="image/*" capture="environment">
                                <label for="file-rental-trasera" class="text-xs bg-blue-600 px-2 py-1 rounded cursor-pointer block">Foto</label>
                            </div>
                             <div class="bg-slate-900 p-2 rounded text-center">
                                <span class="text-xs text-gray-400 block mb-1">Lat. Der.</span>
                                <img id="preview-rental-derecha" src="[https://placehold.co/100x80/333/999](https://placehold.co/100x80/333/999)" class="w-full h-16 object-cover rounded mb-1">
                                <input type="file" id="file-rental-derecha" data-key="derecha" class="hidden rental-photo-input-single" accept="image/*" capture="environment">
                                <label for="file-rental-derecha" class="text-xs bg-blue-600 px-2 py-1 rounded cursor-pointer block">Foto</label>
                            </div>
                             <div class="bg-slate-900 p-2 rounded text-center">
                                <span class="text-xs text-gray-400 block mb-1">Lat. Izq.</span>
                                <img id="preview-rental-izquierda" src="[https://placehold.co/100x80/333/999](https://placehold.co/100x80/333/999)" class="w-full h-16 object-cover rounded mb-1">
                                <input type="file" id="file-rental-izquierda" data-key="izquierda" class="hidden rental-photo-input-single" accept="image/*" capture="environment">
                                <label for="file-rental-izquierda" class="text-xs bg-blue-600 px-2 py-1 rounded cursor-pointer block">Foto</label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Da√±os / Observaciones</label>
                            <textarea id="rental-descripcion-danos" rows="3" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white" placeholder="Abolladuras, ara√±azos..."></textarea>
                            <input type="file" id="file-rental-damage" multiple class="hidden rental-photo-input-damage" accept="image/*" capture="environment">
                            <label for="file-rental-damage" class="mt-2 inline-block bg-amber-600 text-xs py-2 px-3 rounded cursor-pointer hover:bg-amber-500">üì∏ A√±adir Foto Da√±o</label>
                            <div id="rental-damage-photos-container" class="flex gap-2 mt-2 overflow-x-auto"></div>
                        </div>

                        <div id="status-message-alquiler" class="hidden p-3 rounded text-center"></div>
                        <button type="submit" id="submit-button-alquiler" class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg shadow-lg">Confirmar Registro</button>
                    </form>
                </div>

                <div id="alquiler-subpage-gallery" class="alquiler-subpage hidden">
                    <div id="rental-history-list-page">
                        <button class="btn-back-to-alquiler-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                        <input type="search" id="search-rental-history" placeholder="Filtrar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-4">
                        <p id="rental-history-loading-message" class="text-center text-gray-500">Cargando...</p>
                        <div id="rental-history-list-container" class="space-y-3"></div>
                        <div id="rental-history-no-results" class="hidden text-center text-gray-500">Sin registros.</div>
                    </div>
                    <div id="rental-history-detail-page" class="hidden">
                        <button id="btn-back-to-rental-list" class="mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                        <h2 id="rental-history-detail-title" class="text-xl font-bold text-white mb-4"></h2>
                        <div id="rental-history-detail-content" class="space-y-6"></div>
                    </div>
                </div>
            </div>

            <!-- 5. SECCI√ìN ACCIDENTES -->
            <div id="page-accidentes" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <div id="accidentes-choice-menu" class="accidentes-subpage">
                    <h2 class="text-2xl font-bold text-white mb-6 text-center">Accidentes</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <button id="btn-show-accident-upload" class="p-6 bg-red-600/20 border border-red-500/50 hover:bg-red-600/40 rounded-xl text-center">
                            <span class="text-3xl block mb-2">üí•</span>
                            <span class="font-bold text-red-100">Reportar Accidente</span>
                        </button>
                        <button id="btn-show-accident-gallery" class="p-6 bg-slate-700/30 border border-slate-600 hover:bg-slate-700/50 rounded-xl text-center">
                             <span class="text-3xl block mb-2">üìÑ</span>
                            <span class="font-bold text-gray-200">Ver Partes</span>
                        </button>
                    </div>
                </div>

                <div id="accidentes-subpage-upload" class="accidentes-subpage hidden">
                     <button class="btn-back-to-accidentes-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                     <form id="accident-upload-form" class="space-y-6">
                        <input type="text" id="accident-matricula" placeholder="MATR√çCULA" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white uppercase font-bold" required>
                        <input type="text" id="accident-conductor" placeholder="Nombre Conductor" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white" required>
                        
                        <div class="bg-slate-900 p-4 rounded border border-slate-700 text-center">
                            <p class="text-sm text-gray-400 mb-2">Foto del Parte Amistoso</p>
                            <img id="preview-accident-parte" src="[https://placehold.co/400x200/333/999?text=Parte](https://placehold.co/400x200/333/999?text=Parte)" class="w-full h-32 object-cover rounded mb-2">
                            <input type="file" id="file-accident-parte" class="hidden accident-photo-input-single" accept="image/*" capture="environment">
                            <label for="file-accident-parte" class="inline-block bg-blue-600 px-4 py-2 rounded cursor-pointer hover:bg-blue-500 text-sm">Subir Foto</label>
                        </div>

                        <textarea id="accident-descripcion" rows="4" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white" placeholder="Describe qu√© pas√≥..."></textarea>

                        <div id="status-message-accidentes" class="hidden p-3 rounded text-center"></div>
                        <button type="submit" id="submit-button-accidentes" class="w-full py-4 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg">Enviar Reporte</button>
                     </form>
                </div>

                <div id="accidentes-subpage-gallery" class="accidentes-subpage hidden">
                    <div id="accident-history-list-page">
                        <button class="btn-back-to-accidentes-choice mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                        <input type="search" id="search-accident-history" placeholder="Buscar..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-4">
                         <p id="accident-history-loading-message" class="text-center text-gray-500">Cargando...</p>
                         <div id="accident-history-list-container" class="space-y-3"></div>
                         <div id="accident-history-no-results" class="hidden text-center text-gray-500">Vacio.</div>
                    </div>
                    <div id="accident-history-detail-page" class="hidden">
                         <button id="btn-back-to-accident-list" class="mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                         <h2 id="accident-history-detail-title" class="text-xl font-bold text-white mb-4"></h2>
                         <div id="accident-history-detail-content" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- 6. SECCI√ìN ADMIN FLOTA -->
            <div id="page-gestionar-flota" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <h2 class="text-2xl font-bold text-white mb-6">Administrar Flota</h2>
                <form id="add-vehicle-form" class="mb-8 bg-slate-900 p-4 rounded-lg border border-slate-700 space-y-4">
                    <h3 class="text-lg font-bold text-blue-300">A√±adir Furgoneta</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <input type="text" id="add-matricula" placeholder="Matr√≠cula" class="p-2 bg-slate-800 border border-slate-600 rounded text-white uppercase" required>
                        <input type="text" id="add-marca" placeholder="Marca" class="p-2 bg-slate-800 border border-slate-600 rounded text-white" required>
                        <input type="text" id="add-vin" placeholder="VIN (Bastidor)" class="p-2 bg-slate-800 border border-slate-600 rounded text-white uppercase md:col-span-2" required>
                        <input type="text" id="add-poliza" placeholder="P√≥liza (Opcional)" class="p-2 bg-slate-800 border border-slate-600 rounded text-white">
                        <input type="text" id="add-renting" placeholder="Renting (Opcional)" class="p-2 bg-slate-800 border border-slate-600 rounded text-white">
                    </div>
                    <div id="add-vehicle-status" class="hidden text-center text-sm"></div>
                    <button type="submit" id="add-vehicle-button" class="w-full bg-green-600 py-2 rounded font-bold text-white hover:bg-green-500">A√±adir</button>
                </form>
                
                <h3 class="text-lg font-bold text-red-400 mb-4">Quitar Veh√≠culo</h3>
                <input type="search" id="search-manage-van" placeholder="Buscar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-4">
                <div id="manage-vehicle-list" class="space-y-2"></div>
                <div id="manage-no-results-message" class="hidden text-center text-gray-500">No encontrado.</div>
            </div>

            <!-- 7. SECCI√ìN OPERATIVA (INICIO) -->
            <div id="page-operativa-vor" class="page-content bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Estado Flota</h2>
                    <div class="flex space-x-2 text-xs">
                        <span id="btn-filter-all" class="cursor-pointer px-3 py-1 bg-slate-700 rounded text-white">Total: <span id="count-total">0</span></span>
                        <span id="btn-filter-op" class="cursor-pointer px-3 py-1 bg-green-900/50 text-green-300 rounded border border-green-700">Op: <span id="count-operativos">0</span></span>
                        <span id="btn-filter-vor" class="cursor-pointer px-3 py-1 bg-red-900/50 text-red-300 rounded border border-red-700">VOR: <span id="count-vor">0</span></span>
                    </div>
                </div>
                <input type="search" id="search-vor-van" placeholder="Buscar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-6 sticky top-0 z-10">
                <div id="vor-vehicle-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div id="vor-no-results-message" class="hidden text-center text-gray-500">No encontrado.</div>
            </div>

            <!-- 8. SECCI√ìN GUANTERA -->
            <div id="page-guantera" class="page-content hidden bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <div id="guantera-list-page" class="guantera-subpage">
                    <h2 class="text-2xl font-bold text-white mb-6 text-center">Guantera Digital</h2>
                    <input type="search" id="search-guantera-van" placeholder="Buscar matr√≠cula..." class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg text-white mb-6">
                    <div id="guantera-van-list-container" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                    <div id="guantera-no-results" class="hidden text-center text-gray-500">No encontrado.</div>
                </div>
                <div id="guantera-detail-page" class="guantera-subpage hidden">
                    <button id="btn-back-to-guantera-list" class="mb-4 text-blue-400 hover:text-white flex items-center gap-2">‚Üê Volver</button>
                    <h2 id="guantera-detail-title" class="text-2xl font-bold text-white mb-6 text-center"></h2>
                    <div id="guantera-detail-loading" class="text-center text-gray-500">Cargando...</div>
                    <div id="guantera-detail-content" class="space-y-6"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- MODALES FLOTANTES (Ocultos por defecto) -->
    <!-- Modal Editar Fechas -->
    <div id="dates-modal" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-lg rounded-2xl border border-slate-600 p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="dates-modal-title" class="text-xl font-bold text-white">Editar Docs</h3>
                <button id="dates-modal-close-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ITV</label>
                    <input type="text" id="dates-modal-itv" placeholder="DD/MM/AAAA" class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-white">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Revisi√≥n</label>
                    <input type="text" id="dates-modal-revision" placeholder="DD/MM/AAAA" class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-white">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">P√≥liza</label>
                    <input type="text" id="dates-modal-poliza" class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-white">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Renting</label>
                    <input type="text" id="dates-modal-renting" class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-white">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="text-xs text-gray-400 block mb-1">Permiso Circ.</span>
                        <img id="preview-dates-permiso" src="[https://placehold.co/100x80/333/999](https://placehold.co/100x80/333/999)" class="w-full h-16 object-cover rounded mb-2">
                        <input type="file" id="file-dates-permiso" data-key="permiso" class="hidden dates-photo-input" accept="image/*" capture="environment">
                        <label for="file-dates-permiso" class="block text-center bg-blue-600 text-xs py-1 rounded cursor-pointer">Cambiar</label>
                    </div>
                    <div>
                         <span class="text-xs text-gray-400 block mb-1">Ficha T√©c.</span>
                        <img id="preview-dates-ficha" src="[https://placehold.co/100x80/333/999](https://placehold.co/100x80/333/999)" class="w-full h-16 object-cover rounded mb-2">
                        <input type="file" id="file-dates-ficha" data-key="ficha" class="hidden dates-photo-input" accept="image/*" capture="environment">
                        <label for="file-dates-ficha" class="block text-center bg-blue-600 text-xs py-1 rounded cursor-pointer">Cambiar</label>
                    </div>
                </div>
                <div id="dates-modal-status" class="hidden text-center p-2 text-sm"></div>
                <input type="hidden" id="dates-modal-matricula">
                <button id="dates-modal-save-btn" class="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- Modal Editar Tarea -->
    <div id="edit-modal" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-md rounded-2xl border border-slate-600 p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Editar Tarea</h3>
                <button id="edit-modal-close-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <textarea id="edit-modal-note" rows="3" class="w-full p-3 bg-slate-900 border border-slate-600 rounded text-white" placeholder="Nota..."></textarea>
                <textarea id="edit-modal-recambios" rows="2" class="w-full p-3 bg-slate-900 border border-slate-600 rounded text-white" placeholder="Recambios..."></textarea>
                <input type="hidden" id="edit-modal-timestamp">
                <div id="edit-modal-status" class="hidden text-center p-2 text-sm"></div>
                <button id="edit-modal-save-btn" class="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal QR -->
    <div id="qr-modal" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl text-center">
            <h3 class="text-xl font-bold text-slate-900 mb-4">Compartir Furgoneta</h3>
            <canvas id="modal-composite-canvas" class="mx-auto mb-4 border rounded"></canvas>
            <button id="modal-share-btn" class="w-full py-2 bg-blue-600 text-white rounded font-bold mb-2">Compartir</button>
            <button id="modal-close-btn" class="w-full py-2 bg-gray-200 text-gray-800 rounded font-bold">Cerrar</button>
        </div>
    </div>

    <!-- Botones Flotantes -->
    <button id="suggestion-fab" class="hidden fixed bottom-6 right-6 bg-yellow-500 text-black px-4 py-3 rounded-full shadow-lg font-bold z-40 hover:scale-105 transition-transform">üí° Idea</button>
    <button id="help-fab" class="hidden fixed bottom-6 left-6 bg-blue-600 text-white px-4 py-3 rounded-full shadow-lg font-bold z-40 hover:scale-105 transition-transform">‚ùì Ayuda</button>

    <!-- Modal Sugerencias -->
    <div id="suggestion-modal" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-md rounded-2xl border border-slate-600 p-6 shadow-2xl max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-yellow-400">Sugerencias</h3>
                <button id="suggestion-modal-close-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="flex-grow overflow-y-auto mb-4">
                <div id="suggestion-list-container" class="space-y-2 mb-4"></div>
                <p id="suggestion-loading" class="hidden text-center text-gray-500">Cargando...</p>
            </div>
            <form id="suggestion-form" class="space-y-3">
                <input type="text" id="suggestion-modal-name" placeholder="Tu nombre" class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-white" required>
                <textarea id="suggestion-modal-idea" rows="2" placeholder="Tu idea..." class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-white" required></textarea>
                <div id="suggestion-modal-status" class="hidden text-center text-sm"></div>
                <button id="suggestion-modal-save-btn" type="submit" class="w-full py-2 bg-yellow-500 text-black font-bold rounded">Enviar</button>
            </form>
            <div id="suggestion-visit-counter" class="text-center text-xs text-gray-500 mt-2"></div>
        </div>
    </div>

    <!-- Modal Ayuda -->
    <div id="help-modal" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-md rounded-2xl border border-slate-600 p-6 shadow-2xl max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-blue-400">Ayuda R√°pida</h3>
                <button id="help-modal-close-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="space-y-4 text-sm text-gray-300">
                <p><strong class="text-white">Contrase√±a Admin:</strong> Liebre</p>
                <p><strong class="text-white">A√±adir Furgo:</strong> Pesta√±a "Admin Flota".</p>
                <p><strong class="text-white">Marcar VOR:</strong> Pesta√±a "Operativas", bot√≥n rojo/verde.</p>
                <p><strong class="text-white">Editar Docs/Fechas:</strong> Pesta√±a "Operativas", bot√≥n "Editar Docs".</p>
                <p><strong class="text-white">Tel√©fono Jefe Flota:</strong> 632 63 48 46</p>
                <p><strong class="text-white">Gr√∫a (Ayvens):</strong> 915 94 93 89</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 z-[100] bg-black/90 flex flex-col justify-center items-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
        <p id="loading-message" class="text-white font-medium">Cargando...</p>
    </div>

    <script src="app.js" defer></script>
</body>
</html>
